<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>타이틀</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width, user-scalable=0, initial-scale=1, minimum-scale=1, maximum-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>

	<link rel="stylesheet" type="text/css" href="/css/reset.css" />
	<link rel="stylesheet" type="text/css" href="/css/main.css" />
	<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="/js/basic.js" charset="utf-8"></script>

	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

	<script th:inline="javascript">
		var json_data = /*[[${json_data}]]*/ { 
			sTitle:"블로그_검색"
			, sViewAddr:"http://127.0.0.1:8080"
			, sApiAddr:"http://127.0.0.1:8080" 
		}; console.log(json_data);
	</script>
</head>
<body>

<header>
	<nav></nav>
</header>
<main>
	<section class="search">
		<div class="cont">
			<div class="main clear">
				<a href="#" onclick="location.href = location.pathname; return false;">
					<span class="logo material-symbols-outlined nodrag">pageview</span>
				</a>
				<div class="border">
					<div class="box">
						<input id="input_search" type="text" />
						<span id="bt_search" class="search material-symbols-outlined nodrag">search</span>
						<span id="bt_cancel" class="cancel material-symbols-outlined nodrag">cancel</span>
					</div>
				</div>
				
			</div>
			<div class="sub clear">
				<span>연관검색어 : </span>
				<div id="related_keyword" class="keywords nodrag none">
					<span>키워드1</span>
					<span>키워드2</span>
					<span>키워드3</span>
					<span>키워드4</span>
					<span>키워드5</span>
				</div>
			</div>
		</div>
	</section>
	<section class="result">
		<div class="cont">
			<div class="top clear">
				<div id="bt_sort" class="left nodrag">
					<span class="select" data-value="accuracy">정확도순</span>
					 /
					<span data-value="recency">최신순</span>
				</div>
				
				<div id="bt_source" class="right nodrag">
					검색소스 : 
					<span class="select" data-value="kakao">카카오</span>
					<span data-value="naver">네이버</span>
				</div>				
			</div>	
			<div id="list" class="mid none">
				<div class="item clear">
					<div class="left">
						<img src="https://search4.kakaocdn.net/argon/130x130_85_c/BflmoDAkfuD">
					</div>
					<div class="center">
						<h1>태국 <b>여행</b> 일정 DAY1</h1><span>2023.02.16</span>
						<p>"파타야 - MK수끼 - 좀티엔 야시장 파타야(꼬란섬,White &amp; Hazel) - MK수끼 - 좀티엔 야시장(미스터붐팟타이,누텔라바나나로띠,망고바나나파인애플주스) 태국 <b>여행</b> DAY1 파타야(꼬란섬) 이번에 태국으로 4일 동안 <b>여행</b>을 다녀왔다. 첫째 날 방콕 수완나폼공항에서 마이크 택시로 파타야로 이동했다. 3명에서 1000..."</p>
						<a href="#">http://hyeripotato.tistory.com/256</a><a href="#">혜오리감자</a>
					</div>
					<div class="right"></div>
				</div>		
				<div class="item clear">
					<div class="left">
						<img src="https://search4.kakaocdn.net/argon/130x130_85_c/BflmoDAkfuD">
					</div>
					<div class="center">
						<h1>태국 <b>여행</b> 일정 DAY1</h1><span>2023.02.16</span>
						<p>"파타야 - MK수끼 - 좀티엔 야시장 파타야(꼬란섬,White &amp; Hazel) - MK수끼 - 좀티엔 야시장(미스터붐팟타이,누텔라바나나로띠,망고바나나파인애플주스) 태국 <b>여행</b> DAY1 파타야(꼬란섬) 이번에 태국으로 4일 동안 <b>여행</b>을 다녀왔다. 첫째 날 방콕 수완나폼공항에서 마이크 택시로 파타야로 이동했다. 3명에서 1000..."</p>
						<a href="#">http://hyeripotato.tistory.com/256</a><a href="#">혜오리감자</a>
					</div>
					<div class="right"></div>
				</div>
				<div class="item clear">
					<div class="left">
						<img src="https://search4.kakaocdn.net/argon/130x130_85_c/BflmoDAkfuD">
					</div>
					<div class="center">
						<h1>태국 <b>여행</b> 일정 DAY1</h1><span>2023.02.16</span>
						<p>"파타야 - MK수끼 - 좀티엔 야시장 파타야(꼬란섬,White &amp; Hazel) - MK수끼 - 좀티엔 야시장(미스터붐팟타이,누텔라바나나로띠,망고바나나파인애플주스) 태국 <b>여행</b> DAY1 파타야(꼬란섬) 이번에 태국으로 4일 동안 <b>여행</b>을 다녀왔다. 첫째 날 방콕 수완나폼공항에서 마이크 택시로 파타야로 이동했다. 3명에서 1000..."</p>
						<a href="#">http://hyeripotato.tistory.com/256</a><a href="#">혜오리감자</a>
					</div>
					<div class="right"></div>
				</div>
				<div class="item clear">
					<div class="left">
						<img src="https://search4.kakaocdn.net/argon/130x130_85_c/BflmoDAkfuD">
					</div>
					<div class="center">
						<h1>태국 <b>여행</b> 일정 DAY1</h1><span>2023.02.16</span>
						<p>"파타야 - MK수끼 - 좀티엔 야시장 파타야(꼬란섬,White &amp; Hazel) - MK수끼 - 좀티엔 야시장(미스터붐팟타이,누텔라바나나로띠,망고바나나파인애플주스) 태국 <b>여행</b> DAY1 파타야(꼬란섬) 이번에 태국으로 4일 동안 <b>여행</b>을 다녀왔다. 첫째 날 방콕 수완나폼공항에서 마이크 택시로 파타야로 이동했다. 3명에서 1000..."</p>
						<a href="#">http://hyeripotato.tistory.com/256</a><a href="#">혜오리감자</a>
					</div>
					<div class="right"></div>
				</div>
				<div class="item clear">
					<div class="left">
						<img src="https://search4.kakaocdn.net/argon/130x130_85_c/BflmoDAkfuD">
					</div>
					<div class="center">
						<h1>태국 <b>여행</b> 일정 DAY1</h1><span>2023.02.16</span>
						<p>"파타야 - MK수끼 - 좀티엔 야시장 파타야(꼬란섬,White &amp; Hazel) - MK수끼 - 좀티엔 야시장(미스터붐팟타이,누텔라바나나로띠,망고바나나파인애플주스) 태국 <b>여행</b> DAY1 파타야(꼬란섬) 이번에 태국으로 4일 동안 <b>여행</b>을 다녀왔다. 첫째 날 방콕 수완나폼공항에서 마이크 택시로 파타야로 이동했다. 3명에서 1000..."</p>
						<a href="#">http://hyeripotato.tistory.com/256</a><a href="#">혜오리감자</a>
					</div>
					<div class="right"></div>
				</div>
				<div class="item clear">
					<div class="left">
						<img src="https://search4.kakaocdn.net/argon/130x130_85_c/BflmoDAkfuD">
					</div>
					<div class="center">
						<h1>태국 <b>여행</b> 일정 DAY1</h1><span>2023.02.16</span>
						<p>"파타야 - MK수끼 - 좀티엔 야시장 파타야(꼬란섬,White &amp; Hazel) - MK수끼 - 좀티엔 야시장(미스터붐팟타이,누텔라바나나로띠,망고바나나파인애플주스) 태국 <b>여행</b> DAY1 파타야(꼬란섬) 이번에 태국으로 4일 동안 <b>여행</b>을 다녀왔다. 첫째 날 방콕 수완나폼공항에서 마이크 택시로 파타야로 이동했다. 3명에서 1000..."</p>
						<a href="#">http://hyeripotato.tistory.com/256</a><a href="#">혜오리감자</a>
					</div>
					<div class="right"></div>
				</div>
				<div class="item clear">
					<div class="left">
						<img src="https://search4.kakaocdn.net/argon/130x130_85_c/BflmoDAkfuD">
					</div>
					<div class="center">
						<h1>태국 <b>여행</b> 일정 DAY1</h1><span>2023.02.16</span>
						<p>"파타야 - MK수끼 - 좀티엔 야시장 파타야(꼬란섬,White &amp; Hazel) - MK수끼 - 좀티엔 야시장(미스터붐팟타이,누텔라바나나로띠,망고바나나파인애플주스) 태국 <b>여행</b> DAY1 파타야(꼬란섬) 이번에 태국으로 4일 동안 <b>여행</b>을 다녀왔다. 첫째 날 방콕 수완나폼공항에서 마이크 택시로 파타야로 이동했다. 3명에서 1000..."</p>
						<a href="#">http://hyeripotato.tistory.com/256</a><a href="#">혜오리감자</a>
					</div>
					<div class="right"></div>
				</div>
				<div class="item clear">
					<div class="left">
						<img src="https://search4.kakaocdn.net/argon/130x130_85_c/BflmoDAkfuD">
					</div>
					<div class="center">
						<h1>태국 <b>여행</b> 일정 DAY1</h1><span>2023.02.16</span>
						<p>"파타야 - MK수끼 - 좀티엔 야시장 파타야(꼬란섬,White &amp; Hazel) - MK수끼 - 좀티엔 야시장(미스터붐팟타이,누텔라바나나로띠,망고바나나파인애플주스) 태국 <b>여행</b> DAY1 파타야(꼬란섬) 이번에 태국으로 4일 동안 <b>여행</b>을 다녀왔다. 첫째 날 방콕 수완나폼공항에서 마이크 택시로 파타야로 이동했다. 3명에서 1000..."</p>
						<a href="#">http://hyeripotato.tistory.com/256</a><a href="#">혜오리감자</a>
					</div>
					<div class="right"></div>
				</div>
			</div>
	
			<div class="bot clear nodrag">
				<span id="page_pre" class="left material-symbols-outlined ">chevron_left</span>
				<div id="page_list" class="none">
					<span>1</span>
					<span>2</span>
					<span>3</span>
					<span>4</span>
					<span>5</span>
					<span class="select">6</span>
					<span>7</span>
					<span>8</span>
					<span>9</span>
					<span>10</span>
				</div>
				<span id="page_next" class="right material-symbols-outlined">chevron_right</span>
			</div>
		</div>
	</section>
	<section class="side">
		<h1>인기검색어</h1>
		<div id="top10" class="nodrag none">
			<p>1.인기검색(100)</p>
			<p>2.인기검색(92)</p>
			<p>3.인기검색(66)</p>
			<p>4.인기검색(22)</p>
			<p>5.인기검색(10)</p>
			<p>6.인기검색(7)</p>
			<p>7.인기검색(6)</p>
			<p>8.인기검색(6)</p>
			<p>9.인기검색(3)</p>
			<p>10.인기검색(1)</p>
		</div>
	</section>	
</main>
<!-- <footer>Copyright ©2022 My Website</footer> -->
</body>
<script type="text/javascript">
document.title = json_data.sTitle;
</script>
<script type="text/javascript">
var sLastQuery = "";

function ask_blog(sApiType, sQuery, sSort, sPageNum){
	if(typeof sQuery==="undefined" || sQuery==="") return;
	loading_on();

	var sData = "sApiType="+sApiType;
	sData += "&sQuery="+sQuery;
	sData += "&sSort="+sSort;
	try{ if(sPageNum*1>0) sData += "&sPageNum="+sPageNum;
	}catch(e){}
	
	$.ajax({
		url : json_data.sApiAddr+"/api/blogs"
		, type : "GET"
		, data : sData
		, datatype : "application/json"
		, success : res=>{
			loading_off();
			console.log(res);
			if(res.bStatus){
				//블로그 검색 결과.
				var data = res.result.documents;
				data = change_blog_data(data);
				draw_blog_data(data);

				//하단 페이징 
				var nNowPage = res.sPageNum*1;
				if(isNaN(nNowPage)) nNowPage = 1;
				var nMaxPage = res.result.meta.pageable_count*1;
				draw_page_num(nNowPage, nMaxPage);

				//탑10 키워드
				var top10 = res.topKeywords;
				draw_top_keywords(top10);

				//소팅 및 검색소스 설정. 
				draw_search_option(res.sApiType, res.sSort);

				//url 변경 
				var param = {
					sApiType:res.sApiType
					, sQuery:sQuery
					, sSort:res.sSort
					, sPageNum:res.sPageNum
				};
				change_result_url(param);

				//스크롤 위로
				$("html, body").animate({ scrollTop: 0 }, "fast");

				ask_keyword(sQuery);
				sLastQuery = sQuery;

				if(res.bSubApi===true) 
					alert("선택하신 검색소스에 문제가 있어 다른 검색소스로 검색한 결과입니다.");
			}
		}
	});
}

function change_blog_data(data){
	try{ if(data.length===0) return [];
	}catch(e){ return []; }

	var temp;
	for(var i=0; i<data.length; i++){
		try{
			//datetime에서 날짜만 뽑아내기.
			temp = new Date(data[i].datetime);
			data[i]["sDate"] = GET_DATE(temp, "YYYY.MM.DD"); 

			//img 없으면 class 변경
			data[i]["sNoImgClass"] = "";
			if(data[i]["thumbnail"]==="") data[i]["sNoImgClass"] = "noimg";
		}catch(e){ console.log(e); }
	}
	return data;
}	

function draw_blog_data(data) {
	var s = "";

	//list 내용 만들기.
	for(var i=0; i<data.length; i++){
		try{

			s += TEMPLATE(data[i], _=>{
				/*[CDATA[

					<div class="item clear ${sNoImgClass}" data-url="${url}">
						<div class="left">
							<a href="${url}"><img src="${thumbnail}"></a>
						</div>
						<div class="center">
							<a href="${url}"><h1>${title}</h1></a><span>${sDate}</span>
							<p>${contents}</p>
							<a href="${url}">${url}</a><a href="${url}">${blogname}</a>
						</div>
						<div class="right"></div>
					</div>

				]]*/
			});

		}catch(e){ console.log(e); }
	}

	if(s==="") s="검색결과가 없습니다.";

	$("#list").html(s);
	$("#list").removeClass("none");
}

function draw_top_keywords(data){
	try{ if(data.length===0) return; }catch(e){ return; }


	//Cnt로 먼저 소팅하고 같으면 글자로 소팅.
	data.sort((a, b)=>b.keywordCnt-a.keywordCnt || a.keyword.localeCompare(b.keyword));

	var s = "";

	//top10 내용 만들기 
	for(var i=0; i<data.length; i++){
		try{	
			data[i].nIndex = i+1;
			s += TEMPLATE(data[i], _=>{
				/*[CDATA[

					<p>${nIndex}. <span>${keyword}</span> (${keywordCnt})</p>

				]]*/
			});
			
		}catch(e){ console.log(e) }
	}

	$("#top10").html(s);
	$("#top10").removeClass("none");
}	

function draw_page_num(nNowPage, nMaxPage){
	const nPageSize = 10;

	var nStartPage = nNowPage - Math.round(nPageSize/2);
	if(nStartPage<1) nStartPage=1;

	var s = "";
	var nNum, data;
	for(var i=0; i<nPageSize; i++ ){
		nNum = nStartPage+i;
		
		if(nNum===1) $("#page_pre").addClass("disable"); //시작이 0 이면 page_pre 비활성화.
		if(nMaxPage<=nNum) $("#page_next").addClass("disable"); //끝이면 page_next 비활성화.

		if(nMaxPage<nNum) break;

		try{	
			data = {nNum:nNum, sClass:""};
			if(nNum===nNowPage) data.sClass="select";
			s += TEMPLATE(data, _=>{
				/*[CDATA[
					<span class="${sClass}" data-value="${nNum}">${nNum}</span>
				]]*/
			});
		}catch(e){ console.log(e) }
	}

	$("#page_list").html(s);
	$("#page_list").removeClass("none");


}

function draw_search_option(sApiType, sSort){

	//검색 소스 변경
	$("#bt_source span").removeClass("select");
	if(sApiType==="naver") $("#bt_source span[data-value='naver']").addClass("select");
	else $("#bt_source span").eq(0).addClass("select"); //기본은 kakao

	//소팅 타입 변경 
	$("#bt_sort span").removeClass("select");
	if(sSort==="recency") $("#bt_sort span[data-value='recency']").addClass("select");
	else $("#bt_sort span").eq(0).addClass("select");
}

function change_result_url(data) {
	// data : sApiType, sQuery, sSort, sPageNum
	if(typeof data["sQuery"]==="undefined") data["sQuery"]="";

	var url = new URL(window.location.origin+window.location.pathname);
	for(var k in data){
		if(k==="sPageNum" && data[k]==="1") continue; //페이지번호 없이 검색해야 검색 카운트 올라가기 때문에 
		else if(k==="sQuery") continue; //sQuery는 따로 더해줌.
		url.searchParams.set(k, data[k]);
	}
	history.pushState({}, '', url.href+"&sQuery="+data["sQuery"]);
}

function search_blog(sPageNum){
	var sApiType = $("#bt_source span.select").data("value");
	var sQuery = $("#input_search").val();
	var sSort = $("#bt_sort span.select").data("value");
	if(arguments.length>0) ask_blog(sApiType, sQuery, sSort, sPageNum);
	else ask_blog(sApiType, sQuery, sSort);
}



function ask_keyword(sQuery){
	if(typeof sQuery==="undefined" || sQuery==="") return;

	draw_related_keyword();
	var sData = "sQuery="+sQuery
	
	$.ajax({
		url : json_data.sApiAddr+"/api/keyword"
		, type : "GET"
		, data : sData
		, datatype : "application/json"
		, success : res=>{
			console.log(res);
			if(res.bStatus){

				if(sLastQuery===sQuery){
					//출력
					draw_related_keyword(res.relatedKeywords);
				}
			}
		}
	});
}


function draw_related_keyword(data){
	try{ 
		if(data.length===0){
			$("#related_keyword").html("");
			return;
		} 
	}catch(e){ $("#related_keyword").html(""); return; }

	var s = "";

	//연관키워드 내용 만들기 
	for(var i=0; i<data.length; i++){
		try{	

			s += TEMPLATE({keyword:data[i]}, _=>{
				/*[CDATA[

					<span>${keyword}</span>

				]]*/
			});
			
		}catch(e){ console.log(e) }
	}

	$("#related_keyword").html(s);
	$("#related_keyword").removeClass("none");
}
</script>
<script type="text/javascript">
$(document).ready(_=>{
	if(typeof GET["sQuery"]==="undefined") GET["sQuery"] = "카카오 뱅크";

	var sQuery = "";
	if(typeof GET["sQuery"]!=="undefined") sQuery = decodeURI(GET["sQuery"]);
	ask_blog(GET["sApiType"], sQuery, GET["sSort"], GET["sPageNum"]); 


	$("#input_search").val(sQuery); //파라미터 검색키워드 기본입력.
	$("#input_search").focus(); //검색창 포커스

	$("#bt_cancel").click(_=>{ //검색어 지우기
		$("#input_search").val("");
		$("#input_search").focus();
	});

	$("#bt_search").click(search_blog);//검색 버튼 

	$("#input_search").keyup(e=>{ //검색창 엔터시 검색버튼 
		if(e.keyCode===13) $("#bt_search").trigger("click");
	});

	$("#bt_sort span").click(function(){ //소팅 변경 
		if($(this).get(0)===$("#bt_sort span.select").get(0) ){
			var nPageNum = $("#page_list>span.select").data("value")*1;
			if(nPageNum===1) return; //페이지가 1일때 같은 속성클릭은 무시한다.
		}

		$("#bt_sort span").removeClass("select");
		$(this).addClass("select");
		search_blog();
	});

	$("#bt_source span").click(function(){ //검색소스 변경
		if($(this).get(0)===$("#bt_source span.select").get(0) ){
			var nPageNum = $("#page_list>span.select").data("value")*1;
			if(nPageNum===1) return; //페이지가 1일때 같은 속성클릭은 무시한다.
		}

		$("#bt_source span").removeClass("select");
		$(this).addClass("select");
		search_blog();
	});

	$("#page_pre").click(function(){
		if($(this).hasClass("disable")) return;
		var nPageNum = $("#page_list>span.select").data("value")*1-1;
		if(nPageNum<1) return;
		search_blog(nPageNum+"");
	});

	$("#page_next").click(function(){
		if($(this).hasClass("disable")) return;
		var nPageNum = $("#page_list>span.select").data("value")*1+1;
		search_blog(nPageNum+"");
	});

	$(document).on("click", "#page_list>span", function(){
		var sPageNum = $(this).data("value");
		search_blog(sPageNum);
	});


	$(document).on("click", "#top10>p", function(){
		var sKeyword = $(this).find("span").text();
		$("#input_search").val(sKeyword);
		search_blog();
	});


	$(document).on("click", "#related_keyword>span", function(){
		var sKeyword = $(this).text();
		$("#input_search").val(sKeyword);
		search_blog();
	});
});




</script>
<!-- 이하 로딩창 -->
<div id="loading" style="display: none;"></div>
<script type="text/javascript">
var loading_on = _=>_;	
$(document).ready(_=>{
	loading_on = function(){ $("#loading").css("display","block"); };
	loading_off = function(){ $("#loading").css("display","none"); };
});
</script>
<style type="text/css">
#loading{
    position: fixed;
    top: 50%;
    left: 50%;
    margin-left: -2em;
    margin-top: -2em;
    width: 4em;
    height: 4em;
    z-index: 9999999;
    border: 0;
    background: #0000006b;
}
#loading:before{
    content: "";
    display: block;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    border: 6px solid rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s cubic-bezier(0.39, 0.41, 0.72, 0.7) infinite;
    -webkit-animation: spin 1s cubic-bezier(0, 0, 0.43, 0.42) infinite;
}
@keyframes spin { to { -webkit-transform: rotate(360deg); } }
@-webkit-keyframes spin { to { -webkit-transform: rotate(360deg); } }
</style>
<!-- 로딩창끝 -->
</html>